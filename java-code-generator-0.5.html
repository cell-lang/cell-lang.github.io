<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <meta name="description" content="The Cell Programming Language">

  <title>The Cell Programming Language</title>

  <link href="./fonts.css" rel="stylesheet" type="text/css" media="screen">
  <link href="./main.css" rel="stylesheet">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-113669835-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-113669835-1');
  </script>

</head>

<body>
  <div id="container">

    <header id="topbar">
    </header>

    <div id="main-container">
      <div id="main">
        <article class="content">
<h2>Cell &#x279e; Java compiler version 0.5</h2>

<p>Version 0.5 of the Cell to Java code generator is now available, and it's the first version that is meant for actual real-world use. It's still a beta version, but it's feature-complete in the sense that everything that was planned for version 1.0 has now been implemented, and the only thing that's missing now is just more testing.</p>

<p>This release brings a number of syntactic changes, improvements to the interface of the generated code, better support for debugging, and a minimal standard library with documentation.</p>


<h3>Syntactic changes</h3>

<p>The first change is in the syntax of partial membership testing and lookups on relations and mutable relation variables:</p>

<figure class="highlight">
<section>
<pre><code><span class='c'>// <span class='inline-code'>Partial membership testing:</span></span>
<span class='m'>Bool</span> has_key([<span class='m'>Any</span> -&gt; <span class='m'>Any</span>] map, <span class='m'>Any</span> <span class='k'>key</span>) = map(<span class='k'>key</span>, _);

<span class='c'>// Used to be:</span>
<span class='c'>//   Bool has_key([Any -&gt; Any] map, Any key) = map(key, *);</span>
<span class='c'>// The asterisk has been replaced by an underscore</span>

<span class='c'>// <span class='inline-code'>Lookups:</span></span>
<span class='u'>V</span> lookup([<span class='u'>K</span> -&gt; <span class='u'>V</span>] map, <span class='u'>K</span> <span class='k'>key</span>, <span class='u'>V</span> default) =
  <span class='k'>if</span> map(k, _) <span class='k'>then</span> map(k, !) <span class='k'>else</span> default;

<span class='c'>// Used to be:</span>
<span class='c'>//   V lookup([K -&gt; V] map, K key, V default) =</span>
<span class='c'>//     if map(k, *) then map(k, !!) else default;</span>
<span class='c'>// The double exclamation mark has been replaced by a single one</span>
</section>
</figure>
</code></pre>

<p>There have been changes to set/relation comprehension expressions:</p>

<figure class="highlight">
<section>
<pre><code><span class='c'>// <span class='inline-code'>Iterating over a binary or ternary relation:</span></span>
[<span class='u'>X</span> -&gt; <span class='u'>Z</span>] map_values([<span class='u'>X</span> -&gt; <span class='u'>Y</span>] map, (<span class='u'>X</span> -&gt; <span class='u'>Z</span>) f) =
  [x -&gt; f(y) : x y &lt;- map];

<span class='c'>// Used to be:</span>
<span class='c'>//   [X -&gt; Z] map_values([X -&gt; Y] map, (X -&gt; Z) f) =</span>
<span class='c'>//     [x -&gt; f(y) : x, y &lt;- map];</span>
<span class='c'>// The comma between the two iteration variable, <span class='inline-code'>x</span> and <span class='inline-code'>y</span>, is now gone</span>

<span class='c'>// <span class='inline-code'>Iterating over a sequence:</span></span>
[<span class='u'>X</span>] seq_to_set(<span class='u'>X</span>* xs) = [x : x &lt;- xs];

<span class='c'>// Used to be:</span>
<span class='c'>//   [X] seq_to_set(X* xs) = [x : x &lt;~ xs];</span>
<span class='c'>// The wavy arrow <span class='inline-code'>&lt;~</span> has been replaced by a normal one</span>

<span class='c'>// <span class='inline-code'>Destructuring iterator over a sequence of tuples:</span></span>
[(<span class='u'>Y</span>, <span class='u'>X</span>)] seq_to_flipped_set((<span class='u'>X</span>, <span class='u'>Y</span>)* xys) =
  [(y, x) : (x, y) &lt;- xys];

<span class='c'>// Used to be:</span>
<span class='c'>//   [(Y, X)] seq_to_flipped_set((X, Y)* xys) =</span>
<span class='c'>//     [(y, x) : x, y &lt;~ xys];</span>
<span class='c'>// The wavy arrow has been replaced by a normal one, and</span>
<span class='c'>// the destructuring variables are now enclosed in parentheses</span>
</section>
</figure>
</code></pre>

<p>There have also been changes to for loops that iterate over binary or ternary relations:</p>

<figure class="highlight">
<section>
<pre><code><span class='m'>Int</span> sum_of_prods([<span class='m'>Int</span>, <span class='m'>Int</span>] r) {
  res = <span class='n'>0</span>;
  <span class='k'>for</span> x y &lt;- r
    res = res + x * y;
  <span class='k'>return</span> res;
}

<span class='c'>// Used to be:</span>
<span class='c'>//   Int sum_of_prods([Int, Int] r) {</span>
<span class='c'>//     res = 0;</span>
<span class='c'>//     for x, y &lt;- r</span>
<span class='c'>//       res = res + x * y;</span>
<span class='c'>//     return res;</span>
<span class='c'>//   }</span>
<span class='c'>// The comma between the two iteration variable, <span class='inline-code'>x</span> and <span class='inline-code'>y</span>, is now gone</span>
</section>
</figure>
</code></pre>

<p>Note that the syntax for iterating over a sequence of tuples has <strong>not</strong> changed:</p>

<figure class="highlight">
<section>
<pre><code><span class='m'>Int</span> sum_of_prods((<span class='m'>Int</span>, <span class='m'>Int</span>)* seq) {
  res = <span class='n'>0</span>;
  <span class='k'>for</span> x, y &lt;- r <span class='c'>// When destructuring a tuple the comma is still required</span>
    res = res + x * y;
  <span class='k'>return</span> res;
}
</section>
</figure>
</code></pre>

<p>When iterating through a sequence of tuples or a relation you can now also replace variables you aren't going to use with an underscore, with both comprehension expressions and for loops:</p>

<figure class="highlight">
<section>
<pre><code><span class='u'>B</span>* middle((<span class='u'>A</span>, <span class='u'>B</span>, <span class='u'>C</span>)* seq) = (y : _, y, _ &lt;- seq);

[<span class='u'>K</span>] keys([<span class='u'>K</span> -&gt; <span class='u'>V</span>] map) = [k : k _ &lt;- map];

<span class='m'>Float</span> right_col_prod([<span class='m'>Any</span>, <span class='m'>Float</span>] r) {
  prod = <span class='n'>1.0</span>;
  <span class='k'>for</span> _ x &lt;- r
    prod = prod * x;
  <span class='k'>return</span> prod;
}
</section>
</figure>
</code></pre>

<p>and the same goes for destructuring assignments:</p>

<figure class="highlight">
<section>
<pre><code><span class='u'>A</span> left((<span class='u'>A</span>, <span class='u'>B</span>) pair) {
  a, _ = pair;
  <span class='k'>return</span> a;
}
</section>
</figure>
</code></pre>


<h3>Interface of generated code</h3>

<p>There have been two main sets of improvements to the interface of the generated classes. The first one is that each message handler is now mapped its own specific method. For example, given the following automaton:</p>

<figure class="highlight">
<section>
<pre><code><span class='k'>schema</span> <span class='m'>Counter</span> {
  value : <span class='m'>Int</span> = <span class='n'>0</span>;
}

<span class='m'>Counter</span>.increment {
  set value = value + <span class='n'>1</span>;
}

<span class='m'>Counter</span>.decrement {
  set value = value - <span class='n'>1</span>;
}

<span class='m'>Counter</span>.reset {
  set value = <span class='n'>0</span>;
}

<span class='m'>Counter</span>.set(value: <span class='m'>Int</span>) {
  set value = <span class='k'>this</span>.value;
}
</section>
</figure>
</code></pre>

<p>the interface of the generated Java class now looks like this:</p>

<p><figure class="highlight"><section><pre><code><span class='k'>class</span> <span class='m'>Counter</span> {
  Counter();

  <span class='b'>void</span> load(<span class='m'>Reader</span> writer);
  <span class='b'>void</span> save(<span class='m'>Writer</span> reader);

  <span class='b'>void</span> execute(<span class='m'>String</span> message);

  <span class='c'>// These methods are new</span>
  <span class='b'>void</span> increment();
  <span class='b'>void</span> decrement();
  <span class='b'>void</span> reset();
  <span class='b'>void</span> set(<span class='b'>long</span>);
}
</code></pre></section></figure>
</p>

<p>The last four methods allow you to invoke each of the message handlers directly, whereas previously you could only call them using the generic <code class='inline-code-box'><span class='inline-code'>execute(..)</span></code> method:</p>

<figure class="highlight">
<section>
<pre><code>counter.increment();  <span class='c'>// Same as counter.execute("increment");</span>
counter.set(-<span class='n'>1</span>);      <span class='c'>// Same as counter.execute("set(-1)");</span>
</section>
</figure>
</code></pre>

<p>These handler-specific methods are a lot faster and often more convenient. The generic <code class='inline-code-box'><span class='inline-code'>execute(..)</span></code> method is still there though, since there are times when the ability to generically send messages of any type is crucial.</p>

<p>The second improvement is in the mapping of Cell types to Java types. The Cell types <code class='inline-code-box'><span class='inline-code'>Date</span></code>, <code class='inline-code-box'><span class='inline-code'>Time</span></code>, <code class='inline-code-box'><span class='inline-code'>[K -&gt; V]</span></code> are now mapped directly to <code class='inline-code-box'><span class='inline-code'>java.time.LocalDate</span></code>, <code class='inline-code-box'><span class='inline-code'>java.time.LocalDateTime</span></code> and <code class='inline-code-box'><span class='inline-code'>java.util.HashMap</span></code>. Moreover, the <code class='inline-code-box'><span class='inline-code'>Maybe</span></code> type now gets some special treatment too: a type like <code class='inline-code-box'><span class='inline-code'>Maybe[String]</span></code>, for example, is now mapped directly to the Java <code class='inline-code-box'><span class='inline-code'>String</span></code> class, and the value <code class='inline-code-box'><span class='inline-code'>nothing</span></code> is mapped to the Java <code class='inline-code-box'><span class='inline-code'>null</span></code>.</p>

<p>As part of this redesign the old <code class='inline-code-box'><span class='inline-code'>net.cell_lang.Value</span></code> has been eliminated, and now any type that the compiler fails to map to an ad-hoc Java type is returned in textual form. That can make in some cases the generated classes less convenient to use, but since with every new release the use of <code class='inline-code-box'><span class='inline-code'>net.cell_lang.Value</span></code> had become increasingly rare, I felt it just wasn't worth keeping around. In the future a small Java library will be provided for those rare cases where you need to parse the returned data.</p>

<p>Check the <a href='interface-java.html'>interfacing with Java</a> page for all the details.</p>


<h3>Debugging relational automata</h3>

<p>When a message handler fails, it's now possible to figure out what caused the failure, which was very hard to do in previous releases. For that purpose, a new builtin procedure, <code class='inline-code-box'><span class='inline-code'>Error(..)</span></code>, is provided, which takes as argument an automaton instance and returns a <code class='inline-code-box'><span class='inline-code'>String</span></code> that explains the cause of the failure of the last message handler to execute. Here's an example:</p>

<figure class="highlight">
<section>
<pre><code><span class='c'>// <span class='inline-code'>ok</span> is true if the message handler succeeded, false otherwise</span>
ok = automaton &lt;- message;

<span class='k'>if</span> <span class='k'>not</span> ok {
  <span class='c'>// The last message handler failed. <span class='inline-code'>Error(..)</span> returns</span>
  <span class='c'>// a string that describes the cause of the failure.</span>
  err = <span class='m'>Error</span>(automaton);

  <span class='c'>// Printing the error message</span>
  <span class='m'>Print</span>(err);
}
</section>
</figure>
</code></pre>

<p>You can find the details in the <a href='using-relational.html'>using relational automata</a> page.</p>


<h3>Standard library</h3>

<p>The core standard library is now documented <a href='standard-library.html'>here</a>. The library is minimal at the moment, and its documentation is still in a pretty rough form, but both will be gradually expanded and improved in the coming months.</p>


        </article>
      </div>

      <aside id="sidebar">
        <div id='pages'>
          <ul class='toc'>
            <li>Start Here
              <ul class="toc">
                <li><a href='index.html'>Home</a></li>
                <li><a href='overview.html'>Overview</a></li>
                <li><a href='faq.html'>FAQ</a></li>
                <!-- <li><a href='quick.html'>Quick overview</a></li> -->
                <li><a href='example.html'>Introductory example</a></li>
                <li><a href='comparison.html'>A comparison with OOP</a></li>
              </ul>
            </li>
            <li>Rationale
              <ul class="toc">
                <li><a href='relations.html'>Why relations are better than objects</a>
                <!-- <li><a href='state.html'>State</a></li> -->
                <!-- <li><a href='functional.html'>Functional programming</a></li> -->
                <!-- <li><a href='integrity.html'>Encapsulation, equality and data integrity</a></li> -->
              </ul>
            </li>
            <li>Values and Types
              <ul class="toc">
                <li><a href='data.html'>Data</a></li>
                <li><a href='types.html'>Types</a></li>
              </ul>
            </li>
            <li>The Functional Language
              <ul class="toc">
                <li><a href='functions.html'>Functions</a></li>
                <li><a href='imperative.html'>Imperative code</a></li>
                <li><a href='procedures.html'>Procedures</a></li>
                <li><a href='typechecking.html'>Type checking</a></li>
                <li><a href='miscellanea.html'>Protocols, implicit arguments and memoization</a></li>
                <li><a href='benchmarks-functional.html'>Benchmarks</a></li>
              </ul>
            </li>
            <li>Relational Automata
              <ul class="toc">
                <li><a href='relational.html'>Schemas</a></li>
                <li><a href='data-modeling.html'>Data modeling</a></li>
                <li><a href='methods.html'>Methods</a></li>
                <li><a href='aggregate-functions.html'>Aggregate functions</a></li>
                <li><a href='inheritance.html'>Inheritance and polymorphism</a></li>
                <li><a href='wiring.html'>Wiring automata together</a></li>
                <li><a href='design.html'>Design Process</a></li>
                <li><a href='updates.html'>State updates</a></li>
                <li><a href='using-relational.html'>Using relational automata</a></li>
                <li><a href='benchmarks-relational.html'>Benchmarks</a></li>
              </ul>
            </li>
            <li>Reactive Automata
              <ul class="toc">
                <li><a href='reactive.html'>Reactive automata</a></li>
                <li><a href='using-reactive.html'>Using reactive automata</a></li>
                <li><a href='reactive-future-work.html'>Future work</a></li>
              </ul>
            </li>
            <li>Interfacing with...
              <ul class="toc">
                <li><a href='interface-cpp.html'>C++</a></li>
                <li><a href='interface-java.html'>Java</a></li>
                <li><a href='interface-cs.html'>C#</a></li>
              </ul>
            </li>
            <li>Network architecture
              <ul class="toc">
                <li><a href='network-architecture.html'>Overview - <strong>NEW</strong></a></li>
              </ul>
            <li>Miscellanea
              <ul class="toc">
                <li><a href='getting-started.html'>Getting started</a></li>
                <li><a href='standard-library.html'>Standard library</a></li>
                <li><a href='status-roadmap.html'>Status and roadmap</a></li>
                <!-- <li><a href='community.html'>Community and contacts</a></li> -->
              </ul>
            </li>

          </ul>
        </div>
      </aside>
    </div>
  </div>
</body>
</html>
